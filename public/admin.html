<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<link rel="stylesheet" href="style.css">
<title>Admin Panel</title>
</head>

<body>

<!-- LOGIN -->

<div id="login" style="height:100vh;
display:flex;
justify-content:center;
align-items:center;
flex-direction:column;
gap:10px;">

<h2>ğŸ” Admin Login</h2>

<input id="code"
placeholder="Ø§Ø¯Ø®Ù„ Ø§Ù„ÙƒÙˆØ¯"
style="padding:10px;border-radius:10px;border:none;">

<button onclick="login()">
Ø¯Ø®ÙˆÙ„
</button>

</div>



<!-- PANEL -->

<div id="panel" style="display:none;padding:20px;">

<h1>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h1>

<div style="display:flex;gap:20px;margin:20px 0;">

<button onclick="showTab('add')">â• Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</button>
<button onclick="showTab('products')">ğŸ“¦ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</button>
<button onclick="showTab('orders')">ğŸ§¾ Ø§Ù„Ø·Ù„Ø¨Ø§Øª</button>

</div>


<!-- ADD -->

<div id="add">

<h2>Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</h2>

<input id="name" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
<input id="price" placeholder="Ø§Ù„Ø³Ø¹Ø±">
<input id="discount" placeholder="Ø§Ù„Ø®ØµÙ…">
<input id="stock" placeholder="Ø§Ù„ÙƒÙ…ÙŠØ©">
<textarea id="description"
placeholder="Ø§Ù„ÙˆØµÙ"></textarea>

<input type="file" id="images" multiple>

<button onclick="addProduct()">
Ø§Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬
</button>

</div>



<!-- PRODUCTS -->

<div id="products"
style="display:none"></div>



<!-- ORDERS -->

<div id="orders"
style="display:none"></div>

</div>



<script>

//////////////// LOGIN //////////////////

function login(){

fetch("/admin-login",{
method:"POST",
headers:{
"Content-Type":"application/json"
},
body:JSON.stringify({
code:document.getElementById("code").value
})
})
.then(r=>r.json())
.then(d=>{

if(d.success){

document.getElementById("login").style.display="none";
document.getElementById("panel").style.display="block";

loadProducts();
loadOrders();

}else{
alert("Ø§Ù„ÙƒÙˆØ¯ ØºÙ„Ø·!");
}

});

}



//////////////// TABS //////////////////

function showTab(tab){

document.getElementById("add").style.display="none";
document.getElementById("products").style.display="none";
document.getElementById("orders").style.display="none";

document.getElementById(tab).style.display="block";

}



////////////// BASE64 //////////////////

function toBase64(file){

return new Promise(resolve=>{

const reader = new FileReader();

reader.readAsDataURL(file);

reader.onload = ()=>resolve(reader.result);

});

}



//////////////// ADD PRODUCT //////////////////

async function addProduct(){

let imgs=[];

for(let file of images.files){
imgs.push(await toBase64(file));
}

fetch("/api/products",{
method:"POST",
headers:{
"Content-Type":"application/json"
},
body:JSON.stringify({

name:name.value,
price:Number(price.value),
discount:Number(discount.value),
stock:Number(stock.value),
description:description.value,
images:imgs

})
})
.then(()=>{

alert("ØªÙ… Ø§Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ ğŸ”¥");

loadProducts();

});

}



//////////////// LOAD PRODUCTS //////////////////

function loadProducts(){

fetch("/api/products")
.then(r=>r.json())
.then(data=>{

products.innerHTML="<h2>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h2>";

data.forEach(p=>{

products.innerHTML+=`

<div style="background:#020617;
padding:10px;
margin:10px 0;
border-radius:10px;">

<img src="${p.images[0]}"
width="60">

<b>${p.name}</b>

<br>
Ø§Ù„Ø³Ø¹Ø±: ${p.price}

<br>
Ø§Ù„Ø®ØµÙ…: ${p.discount}

<br>
Ø§Ù„Ù…Ø®Ø²ÙˆÙ†: ${p.stock}

<br>

<button onclick="deleteProduct(${p.id})">
Ø­Ø°Ù
</button>

</div>

`;

});

});

}



//////////////// DELETE //////////////////

function deleteProduct(id){

fetch("/api/products/"+id,{
method:"DELETE"
})
.then(()=>loadProducts());

}



//////////////// LOAD ORDERS //////////////////

function loadOrders(){

fetch("/api/orders")
.then(r=>r.json())
.then(data=>{

orders.innerHTML="<h2>Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h2>";

data.forEach(o=>{

orders.innerHTML+=`

<div style="background:#020617;
padding:10px;
margin:10px 0;
border-radius:10px;">

<b>ğŸ‘¤ ${o.customer.name}</b>

<br>
ğŸ“ ${o.customer.phone}

<br>
ğŸ“ ${o.customer.address}

<hr>

${o.cart.map(p=>`
<p>${p.name} Ã— ${p.qty}</p>
`).join("")}

</div>

`;

});

});

}

</script>

</body>
  </html>
