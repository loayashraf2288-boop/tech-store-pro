<!DOCTYPE html>
<html lang="ar">
<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="style.css">

<title>Ø§Ù„Ø³Ù„Ø©</title>

<style>

.container{
max-width:900px;
margin:auto;
padding:20px;
}

.cartItem{
background:white;
padding:15px;
margin-top:10px;
display:flex;
gap:20px;
align-items:center;
}

.cartItem img{
width:100px;
}

.total{
font-size:22px;
color:#B12704;
margin-top:20px;
}

.checkout{
background:white;
padding:20px;
margin-top:20px;
}

input{
width:100%;
padding:10px;
margin-top:10px;
}

button{
padding:12px;
border:none;
background:#ffd814;
cursor:pointer;
margin-top:10px;
}

</style>

</head>

<body>

<div class="container">

<h1>ğŸ›’ Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª</h1>

<div id="cart"></div>

<div class="total" id="total"></div>


<!-- COUPON -->

<input id="coupon" placeholder="ÙƒÙˆØ¯ Ø§Ù„Ø®ØµÙ…">

<button onclick="applyCoupon()">
ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯
</button>



<!-- CHECKOUT -->

<div class="checkout">

<h2>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø­Ù†</h2>

<input id="name" placeholder="Ø§Ù„Ø§Ø³Ù…">
<input id="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
<input id="address" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†">

<button onclick="checkout()">
ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨
</button>

</div>

</div>



<script>

let cart = JSON.parse(localStorage.getItem("cart")) || [];

let discount=0;



function drawCart(){

const box=document.getElementById("cart");

box.innerHTML="";

let total=0;

cart.forEach(item=>{

total+=item.price;

box.innerHTML+=`

<div class="cartItem">

<img src="${item.image}">

<div>
<h3>${item.name}</h3>
<p>${item.price} Ø¬Ù†ÙŠÙ‡</p>
</div>

</div>

`;

});

total = total - discount;

document.getElementById("total").innerText=
"Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: "+total+" Ø¬Ù†ÙŠÙ‡";

}



drawCart();



// APPLY COUPON

async function applyCoupon(){

const code=document.getElementById("coupon").value;

const res=await fetch("/api/check-coupon",{

method:"POST",
headers:{
"Content-Type":"application/json"
},
body:JSON.stringify({code})

});

const data=await res.json();

if(!data.valid){

alert("ÙƒÙˆØ¯ ØºÙŠØ± ØµØ­ÙŠØ­ âŒ");
return;

}

discount=data.discount;

alert("ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø®ØµÙ… ğŸ”¥");

drawCart();

}



// CHECKOUT

async function checkout(){

if(!name.value || !phone.value || !address.value){

alert("Ø§Ù…Ù„Ù‰ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
return;

}

await fetch("/api/orders",{

method:"POST",
headers:{
"Content-Type":"application/json"
},

body:JSON.stringify({

name:name.value,
phone:phone.value,
address:address.value,
cart

})

});

alert("ØªÙ… Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­ ğŸ”¥");

localStorage.removeItem("cart");

location.href="/";

}

</script>

</body>
</html>
