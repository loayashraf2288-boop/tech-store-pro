<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Ø§Ù„Ø³Ù„Ø© | TECH STORE</title>

<style>

body{
margin:0;
font-family:Arial;
background:#eaeded;
}

/* NAVBAR */

.nav{
background:#131921;
color:white;
padding:20px;
font-size:24px;
font-weight:bold;
}

/* LAYOUT */

.container{
display:grid;
grid-template-columns:2fr 1fr;
gap:20px;
padding:30px;
}

/* CART ITEMS */

.item{
background:white;
display:flex;
gap:20px;
padding:15px;
border-radius:10px;
margin-bottom:15px;
}

.item img{
width:120px;
object-fit:contain;
}

.qty button{
padding:5px 10px;
margin:5px;
cursor:pointer;
}

/* BILL */

.bill{
background:white;
padding:20px;
border-radius:10px;
height:fit-content;
}

.total{
font-size:22px;
color:#B12704;
margin:10px 0;
}

.checkout{
width:100%;
padding:12px;
border:none;
background:#FFD814;
font-weight:bold;
cursor:pointer;
border-radius:8px;
}

.checkout:hover{
background:#F7CA00;
}

input{
width:100%;
padding:10px;
margin-top:10px;
border-radius:6px;
border:1px solid #ccc;
}

@media(max-width:900px){
.container{
grid-template-columns:1fr;
}
}

</style>
</head>

<body>

<div class="nav">
ğŸ›’ Ø³Ù„Ø© Ø§Ù„Ù…Ø´ØªØ±ÙŠØ§Øª
</div>

<div class="container">

<div id="cartItems"></div>

<div class="bill">

<h3>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø­Ù†</h3>

<input id="name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„">
<input id="phone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
<input id="address" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†">
<input id="home" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù…Ù†Ø²Ù„">
<input id="floor" placeholder="Ø§Ù„Ø¯ÙˆØ±">
<input id="apartment" placeholder="Ø§Ù„Ø´Ù‚Ø©">

<h2 class="total" id="total"></h2>

<p>Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹: <b>Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…</b></p>

<button class="checkout" onclick="checkout()">
ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø·Ù„Ø¨
</button>

</div>

</div>

<script>

let cart = JSON.parse(localStorage.getItem("cart")) || [];

function drawCart(){

const container=document.getElementById("cartItems");

if(cart.length===0){
container.innerHTML="<h2>Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ© ğŸ˜¢</h2>";
return;
}

let total=0;

container.innerHTML="";

cart.forEach(p=>{

const priceAfter =
p.discount>0
? p.price - (p.price*p.discount/100)
: p.price;

total+=priceAfter*p.qty;

container.innerHTML+=`

<div class="item">

<img src="${p.image}">

<div>

<h3>${p.name}</h3>

<p>${priceAfter} Ø¬Ù†ÙŠÙ‡</p>

<div class="qty">

<button onclick="changeQty(${p.id},-1)">-</button>
${p.qty}
<button onclick="changeQty(${p.id},1)">+</button>

</div>

<button onclick="remove(${p.id})">
Ø­Ø°Ù
</button>

</div>

</div>

`;

});

document.getElementById("total").innerText=
"Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ: "+total+" Ø¬Ù†ÙŠÙ‡";

}

function changeQty(id,delta){

const item=cart.find(p=>p.id===id);

item.qty+=delta;

if(item.qty<=0){
cart=cart.filter(p=>p.id!==id);
}

localStorage.setItem("cart",JSON.stringify(cart));

drawCart();

}

function remove(id){

cart=cart.filter(p=>p.id!==id);

localStorage.setItem("cart",JSON.stringify(cart));

drawCart();

}

async function checkout(){

const name=document.getElementById("name").value;
const phone=document.getElementById("phone").value;
const address=document.getElementById("address").value;
const home=document.getElementById("home").value;
const floor=document.getElementById("floor").value;
const apartment=document.getElementById("apartment").value;

if(!name || !phone || !address || !home || !floor || !apartment){

alert("Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ù…Ù„Ù‰ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª â—");
return;

}

await fetch("/api/orders",{

method:"POST",
headers:{'Content-Type':'application/json'},

body:JSON.stringify({

name,
phone,
address,
home,
floor,
apartment,
cart

})

});

alert("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­ âœ…");

localStorage.removeItem("cart");

location.href="/";

}

drawCart();

</script>

</body>
</html>
