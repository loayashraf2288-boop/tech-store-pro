<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<link rel="stylesheet" href="style.css">

<title id="title"></title>

<style>

.productContainer{
display:grid;
grid-template-columns:1fr 1fr;
gap:40px;
padding:40px;
}

.productImg{
width:100%;
border-radius:20px;
}

.qtyBox{
display:flex;
gap:10px;
align-items:center;
margin:15px 0;
}

.qtyBtn{
width:40px;
height:40px;
font-size:20px;
}

.buyBtn{
font-size:18px;
margin-top:10px;
}

@media(max-width:900px){
.productContainer{
grid-template-columns:1fr;
}
}

</style>

</head>

<body>

<nav>
<div class="logo" id="logo"></div>
</nav>


<div id="product"></div>


<script>

//////////////////////////////
// Ø§Ø³Ù… Ø§Ù„Ù…ØªØ¬Ø±
//////////////////////////////

fetch("/store-name")
.then(r=>r.json())
.then(data=>{
document.getElementById("logo").innerText="ğŸ”¥ "+data.name;
document.getElementById("title").innerText=data.name;
});



//////////////////////////////
// Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù†ØªØ¬
//////////////////////////////

const params = new URLSearchParams(location.search);
const id = params.get("id");

let productData;
let quantity=1;

fetch("/api/products")
.then(r=>r.json())
.then(products=>{

productData = products.find(p=>p.id==id);

if(!productData){
document.getElementById("product").innerHTML=
"<h2 style='padding:40px'>Ø§Ù„Ù…Ù†ØªØ¬ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯</h2>";
return;
}

renderProduct();

});



//////////////////////////////
// Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù†ØªØ¬
//////////////////////////////

function renderProduct(){

const price = productData.discount
? productData.price - productData.discount
: productData.price;

document.getElementById("product").innerHTML=`

<div class="productContainer">

<img 
src="${productData.images[0]}" 
class="productImg"
>

<div>

<h1>${productData.name}</h1>

<p>${productData.description || ""}</p>

${productData.discount ? 
`<small style="text-decoration:line-through">
${productData.price} Ø¬Ù†ÙŠÙ‡
</small>` : ""}

<h2 style="color:#00ffcc">
${price} Ø¬Ù†ÙŠÙ‡
</h2>

<p>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${productData.stock}</p>


<div class="qtyBox">

<button class="qtyBtn"
onclick="changeQty(-1)">-</button>

<h2 id="qty">1</h2>

<button class="qtyBtn"
onclick="changeQty(1)">+</button>

</div>


<button class="buyBtn"
onclick="buyNow()">
Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ù„Ø§Ø³ØªÙ„Ø§Ù…
</button>

</div>

</div>

`;

}



//////////////////////////////
// ØªØºÙŠÙŠØ± Ø§Ù„ÙƒÙ…ÙŠØ©
//////////////////////////////

function changeQty(num){

quantity += num;

if(quantity < 1) quantity=1;

if(quantity > productData.stock){
alert("Ø§Ù„ÙƒÙ…ÙŠØ© Ø£ÙƒØ¨Ø± Ù…Ù† Ø§Ù„Ù…Ø®Ø²ÙˆÙ†!");
quantity = productData.stock;
}

document.getElementById("qty").innerText=quantity;

}



//////////////////////////////
// Ø´Ø±Ø§Ø¡ Ø§Ù„Ù…Ù†ØªØ¬
//////////////////////////////

function buyNow(){

const name = prompt("Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ");
const phone = prompt("Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ");
const address = prompt("Ø§Ù„Ø¹Ù†ÙˆØ§Ù†");
const apartment = prompt("Ø±Ù‚Ù… Ø§Ù„Ø´Ù‚Ø©");
const floor = prompt("Ø§Ù„Ø¯ÙˆØ±");

if(!name || !phone || !address){
alert("Ø§ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª!");
return;
}

fetch("/api/orders",{
method:"POST",
headers:{
"Content-Type":"application/json"
},
body:JSON.stringify({

customer:{
name,
phone,
address,
apartment,
floor
},

cart:[{
...productData,
qty:quantity
}]

})
});

alert("ØªÙ… Ø§Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­ ğŸ”¥");

}

</script>

</body>
</html>
